<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>謎解きウォークラリー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 2s ease-in-out;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .container {
            text-align: center;
            color: white;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            font-size: 1.5rem;
            max-width: 90%;
            padding: 2rem;
        }
        .visible {
            opacity: 1;
        }
        .version {
            font-size: 0.8rem;
            color: #6b7280; /* gray-500 */
            margin-top: 1rem;
        }
    </style>
</head>
<body class="bg-white">

    <div id="message-container" class="container">
        <!-- 謎解き成功後に表示されるメッセージ -->
        <p>キーワードは「風」です。</p>
        <p>次の場所へ移動してください。</p>
        <div id="version-info" class="version"></div>
    </div>

    <script>
        // DOM要素と状態変数を取得
        const body = document.body;
        const messageContainer = document.getElementById('message-container');
        const versionInfoElement = document.getElementById('version-info');

        // バージョン情報を定義
        const versionInfo = "v2.0";

        // タッチイベントの追跡用変数
        let lastTouchX = null;
        let lastTouchY = null;
        let directionCount = 0;
        let lastDirection = null;
        const threshold = 20; // 移動距離の閾値（ピクセル）
        const requiredMoves = 5; // 必要な方向転換回数

        // 指が動いたときのイベントリスナー
        body.addEventListener('touchmove', function(e) {
            e.preventDefault(); // 画面のスクロールを防止

            const touch = e.touches[0];
            const currentX = touch.clientX;
            const currentY = touch.clientY;

            if (lastTouchX !== null && lastTouchY !== null) {
                const deltaX = currentX - lastTouchX;
                const deltaY = currentY - lastTouchY;

                let currentDirection = null;
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > threshold) {
                    currentDirection = (deltaX > 0) ? 'right' : 'left';
                } else if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > threshold) {
                    currentDirection = (deltaY > 0) ? 'down' : 'up';
                }
                
                // 方向が大きく変わった場合にカウント
                if (currentDirection && currentDirection !== lastDirection) {
                    directionCount++;
                    lastDirection = currentDirection;
                    console.log(`現在の方向転換回数: ${directionCount}`);
                }
            }
            
            lastTouchX = currentX;
            lastTouchY = currentY;

            // 必要な方向転換回数を超えたら仕掛けを作動させる
            if (directionCount >= requiredMoves) {
                activateRiddle();
            }
        });

        // 指が画面から離れたときのイベントリスナー（リセット）
        body.addEventListener('touchend', function() {
            lastTouchX = null;
            lastTouchY = null;
            // 指が離れたら方向のカウントをリセット
            directionCount = 0;
            lastDirection = null;
        });

        // 謎解き成功時の処理
        function activateRiddle() {
            // イベントリスナーを削除して、一度しか作動しないようにする
            body.removeEventListener('touchmove', arguments.callee);
            body.removeEventListener('touchend', arguments.callee);

            // 背景色を白から黒へ変更
            body.classList.remove('bg-white');
            body.classList.add('bg-gray-900');

            // メッセージを表示
            messageContainer.classList.add('visible');
            versionInfoElement.textContent = `バージョン: ${versionInfo}`;

            // 5秒後に次のページへ遷移
            setTimeout(() => {
                window.location.href = "https://www.google.com"; // ここを次のURLに変更
            }, 5000);
        }

    </script>
</body>
</html>
